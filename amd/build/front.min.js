define ("local_shop/front",["jquery","core/log","core/config","core/str"],function(a,b,c,d){var f={eulas:"required",shopid:0,units:0,required:0,assigned:0,endusermobilephonerequired:0,strings:[],init:function init(c){d.get_strings([{key:"invalidemail",component:"local_shop"},{key:"notallassigned",component:"local_shop"},{key:"continue",component:"local_shop"},{key:"emptyorder",component:"local_shop"}]).done(function(a){f.strings=a});a(".shop-description-toggle").bind("click",this.toggle_description);a(".local-shop-detail-delete").bind("click",this.clear_product);a(".local-shop-order-detail").bind("change",this.update_product);a(".local-shop-password").bind("keypress",this.check_pass_code);a(".local-shop-email").bind("change",this.check_email);a(".local-shop-add-unit").bind("click",this.add_unit);a(".local-shop-delete-unit").bind("click",this.delete_unit);a(".local-shop-add-assign").bind("change",this.add_assign);a(".local-shop-delete-assign").bind("click",this.delete_assign);a(".local-shop-toggle-invoiceinfo").bind("change",this.toggle_invoiceinfo);a(".local-shop-delete-user").bind("click",this.delete_user);a(".local-shop-add-user").bind("click",this.add_user);if(c){f.shopid=c.shopid;f.units=c.units;f.required=c.required;f.assigned=c.assigned;f.endusermobilephonerequired=c.endusermobilephonerequired}b.debug("AMD Local Shop Front initialized")},initeulas:function initeulas(c){a("#shop-eula-confirm").bind("click",this.accept_eulas);if(c){if("required"===c.eulas){a("#region-pre").css("display","none")}f.eulas=c.eulas}b.debug("AMD Local Shop Front Eulas initialized")},toggle_description:function toggle_description(){var b=a(this);if(b.attr("src").match("/open/")){b.attr("src",b.attr("src").replace("open","close"));b.parent().parent().children(".shop-front-description").removeClass("shop-desc-gradient")}else{b.attr("src",b.attr("src").replace("close","open"));b.parent().parent().children(".shop-front-description").addClass("shop-desc-gradient")}},toggle_invoiceinfo:function toggle_invoiceinfo(){var b;if(this.checked){a("#shop-invoiceinfo-wrapper").css("display","block");if(""==document.driverform.elements["invoiceinfo::organisation"].value){b=document.driverform.elements["invoiceinfo::organisation"];b.value=document.driverform.elements["customerinfo::organisation"].value}if(""==document.driverform.elements["invoiceinfo::city"].value){b=document.driverform.elements["invoiceinfo::city"];b.value=document.driverform.elements["customerinfo::city"].value}}else{a("#shop-invoiceinfo-wrapper").css("display","none")}},accept_eulas:function accept_eulas(){var b;if(1==a("#shop-agreeeula").val()){a("#euladiv").css("display","none");a("#order").css("display","block");a("#order").css("visibility","show");a("#region-pre").css("display","block");a("#region-pre").css("visibility","show");b=c.wwwroot+"/local/shop/front/ajax/service.php";b+="?what=agreeeulas";b+="&service=order";b+="&id="+f.shopid}else{b=c.wwwroot+"/local/shop/front/ajax/service.php";b+="?what=reseteulas";b+="&service=order";b+="&id="+f.shopid}a.get(b)},reset_eulas:function reset_eulas(){if("agreed"==f.eulas){var b=c.wwwroot+"/local/shop/front/ajax/service.php";b+="?what=reseteulas";b+="&service=order";b+="&id="+f.shopid;a.get(b)}},add_assign:function add_assign(){var b=a(this),d=b.attr("data-role"),e=b.attr("data-product"),g=c.wwwroot+"/local/shop/front/ajax/service.php",h=b.attr("data-requiredroles").split(","),i,j;for(j in h){i=h[j];a("#addassign"+i+"list"+e).html(f.waiter())}a.post(g,{id:f.shopid,service:"users",what:"addassign",role:d,product:e,participantid:this.options[this.selectedIndex].value},function(b){var c=JSON.parse(b);for(j in h){i=h[j];a("#addassign"+i+"list"+e).html(c.content[i])}f.assigned++;if(f.assigned<f.required){a("#next-button").css("opacity","0.5");a("#next-button").removeClass("shop-active-button");a("#next-button").attr("disabled","disabled");a("#next-button").attr("title",f.strings[1])}else{a("#next-button").css("opacity","1.0");a("#next-button").addClass("shop-active-button");a("#next-button").attr("disabled",null);a("#next-button").attr("title",f.strings[2])}},"html")},delete_assign:function delete_assign(b,d,e){var g=a(this),b=g.attr("data-role"),d=g.attr("data-product"),e=g.attr("data-email"),h=c.wwwroot+"/local/shop/front/ajax/service.php",i=g.attr("data-requiredroles").split(","),j,k;for(k in i){j=i[k];a("#assignrole"+j+"list"+d).html(f.waiter())}a.post(h,{id:f.shopid,service:"users",what:"deleteassign",role:b,product:d,participantid:e},function(b){var c=JSON.parse(b);for(k in i){j=i[k];a("#assignrole"+j+"list"+d).html(c.content[j])}f.assigned--;if(0>f.assigned){f.assigned=0}if(f.assigned<f.required){a("#next-button").css("opacity","0.5");a("#next-button").removeClass("shop-active-button");a("#next-button").attr("disabled","disabled");a("#next-button").attr("title",f.strings[1])}else{a("#next-button").css("opacity","1.0");a("#next-button").addClass("shop-active-button");a("#next-button").attr("disabled",null);a("#next-button").attr("title",f.strings[2])}},"html")},add_unit:function add_unit(d){d.stopPropagation();d.preventDefault();var e=a(this),g=e.attr("data-product"),h=c.wwwroot+"/local/shop/front/ajax/service.php";a("#bag_"+g).html(f.waiter());a.post(h,{id:f.shopid,service:"shop",what:"addunit",productname:g},function(c){var d=JSON.parse(c);a("#bag_"+g).html(d.html);f.update_details();f.update_totals();var h=e.attr("data-maxquant");b.debug(h+">="+d.quant);if(0<h&&d.quant>=h){a("#ci-"+g).attr("disabled","disabled");a("#cimod-"+g).attr("disabled","disabled")}},"html");f.units++;a("#next-button").attr("disabled",null);a("#next-button").addClass("shop-active-button");a("#next-button").css("opacity","1.0");a("#next-button").attr("title",f.strings[2])},delete_unit:function delete_unit(d){d.stopPropagation();d.preventDefault();var e=a(this),g=e.attr("data-product"),h=c.wwwroot+"/local/shop/front/ajax/service.php";a("#bag_"+g).html(f.waiter());a.post(h,{id:f.shopid,service:"shop",what:"deleteunit",productname:g,clearall:0},function(c){var d=JSON.parse(c);a("#bag_"+g).html(d.html);f.update_details();f.update_totals();b.debug("enabling product add button "+g);a("#ci-"+g).attr("disabled",null);a("#cimod-"+g).attr("disabled",null)},"html");f.units--;if(0==f.units){a("#next-button").attr("disabled","disabled");a("#next-button").removeClass("shop-active-button");a("#next-button").css("opacity","0.5");a("#next-button").attr("title",f.strings[3])}},clear_product:function clear_product(b){b.stopPropagation();b.preventDefault();var d=a(this),e=d.attr("data-product"),g=c.wwwroot+"/local/shop/front/ajax/service.php";a("#bag_"+e).html(f.waiter());a("#id_"+e).val(0);a("#ci-"+e).attr("disabled",null);a("#id_total_"+e).val(0);a.post(g,{id:f.shopid,service:"shop",what:"deleteunit",productname:e,clearall:1},function(b){var c=JSON.parse(b);a("#bag_"+e).html(c.html);f.update_details();f.update_totals()},"html")},update_product:function update_product(b){b.stopPropagation();b.preventDefault();var d=a(this),e=d.attr("data-product"),g=d.attr("data-maxquant"),h=c.wwwroot+"/local/shop/front/ajax/service.php",i=a("#id_"+e).val();if(0<g&&i>g){i=g}a("#id_"+e).val(i);a("#bag_"+e).html(f.waiter());a.post(h,{id:f.shopid,service:"shop",what:"setunits",productname:e,quant:i},function(b){var c=JSON.parse(b);a("#bag_"+e).html(c.html);f.update_details();f.update_totals()},"html")},update_totals:function update_totals(){var b=c.wwwroot+"/local/shop/front/ajax/service.php";a("#shop-ordertotals").html(f.waiter());a.post(b,{id:f.shopid,service:"shop",what:"ordertotals"},function(b){var c=JSON.parse(b);a("#shop-ordertotals").html(c.html);a(".local-shop-detail-delete").unbind("click");a(".local-shop-detail-delete").bind("click",f.clear_product);a(".local-shop-order-detail").unbind("change");a(".local-shop-order-detail").bind("change",f.update_product)},"html")},update_details:function update_details(){var b=c.wwwroot+"/local/shop/front/ajax/service.php";a("#order-detail").html(f.waiter());a.post(b,{id:f.shopid,service:"shop",what:"orderdetails"},function(b){var c=JSON.parse(b);a("#order-detail").html(c.html);a(".local-shop-delete-unit").unbind("click");a(".local-shop-delete-unit").bind("click",f.delete_unit)},"html")},add_user:function add_user(){var b=a(this),d=document.forms.participant,e=c.wwwroot+"/local/shop/front/ajax/service.php",g=b.attr("data-requiredroles"),h=g.split(","),i=b.attr("data-products"),k=i.split(","),l={};l.lastname=d.lastname.value;l.firstname=d.firstname.value;l.email=d.email.value;l.city=d.city.value;if(!f.enduserorganisationrequired){l.institution=d.institution.value}if(!f.endusermobilephonerequired){l.phone2=d.phone2.value}a("#participantlist").html(f.waiter());a.post(e,{id:f.shopid,service:"users",what:"addparticipant",participant:JSON.stringify(l),roles:JSON.stringify(h)},function(c){var d,g,l;a("#participantlist").html(c);a(".local-shop-delete-user").unbind("click");a(".local-shop-delete-user").bind("click",f.delete_user);d=document.forms.participant;d.lastname.value="";d.firstname.value="";d.email.value="";if(!f.endusermobilephonerequired){d.phone2.value=""}var m=b.attr("data-availableseats");m--;b.attr("data-availableseats",m);if(0===m){b.attr("disabled","disabled")}for(g=0;g<h.length;g++){for(l=0;l<k.length;l++){a("#"+h[g]+"list"+k[l]).html(f.waiter())}}a.post(e,{id:f.shopid,service:"users",what:"assignalllistobj"},function(b){var c,d,e,f,g,l;g=JSON.parse(b);for(c=0;c<h.length;c++){e=h[c];for(d=0;d<k.length;d++){f=k[d];l=g.content[e][f];a("#"+e+"list"+f).html(l)}}a(".local-shop-add-assign").unbind("change");a(".local-shop-add-assign").bind("change",this.add_assign)},"html")},"html")},delete_user:function delete_user(){var b=a(this),d=b.attr("data-ptmail"),e=c.wwwroot+"/local/shop/front/ajax/service.php",g=b.attr("data-requiredroles"),h=g.split(","),i=b.attr("data-products"),k=i.split(",");a("#participantlist").html(f.waiter());a.post(e,{id:f.shopid,service:"users",what:"deleteparticipant",participantid:d,roles:JSON.stringify(h)},function(c){var d,g;a("#participantlist").html(c);a(".local-shop-delete-user").unbind("click");a(".local-shop-delete-user").bind("click",f.delete_user);var l=b.attr("data-availableseats");b.attr("data-availableseats",l+1);b.attr("disabled",null);a("#addparticipant-line").css("display","block");for(d=0;d<h.length;d++){for(g=0;g<k.length;g++){a("#"+h[d]+"list"+k[g]).html(f.waiter())}}a.post(e,{id:f.shopid,service:"users",what:"assignalllistobj"},function(b){var c,d,e,f,g,l;g=JSON.parse(b);for(c=0;c<h.length;c++){e=h[c];for(d=0;d<k.length;d++){f=k[d];l=g.content[e][f];a("#"+e+"list"+f).html(l)}}a(".local-shop-add-assign").unbind("change");a(".local-shop-add-assign").bind("change",this.add_assign)},"html")})},check_pass_code:function check_pass_code(b){var d=a(this),e=d.attr("data-product"),g=c.wwwroot+"/local/shop/front/ajax/service.php",h="<img width=\"14\" height=\"14\" src=\""+c.wwwroot+"/local/shop/pix/ajaxloader.gif\" />",i="<img width=\"14\" height=\"14\" src=\""+c.wwwroot+"/local/shop/pix/valid.png\" />",j="<img width=\"14\" height=\"14\" src=\""+c.wwwroot+"/local/shop/pix/invalid.png\" />";a("#ci-pass-status-"+e).html(h);a("#cimod-pass-status-"+e).html(h);var k=d.val()+b.key;a.post(g,{id:f.shopid,service:"shop",what:"checkpasscode",productname:e,passcode:k},function(b){var c=JSON.parse(b);if("passed"==c.status){a("#ci-"+e).attr("disabled",null);a("#ci-pass-status-"+e).html(i);a("#cimod-"+e).attr("disabled",null);a("#cimod-pass-status-"+e).html(i)}else{a("#ci-pass-status-"+e).html(j);a("#cimod-pass-status-"+e).html(j)}},"html")},check_email:function check_email(){var b=a(this);if(/^\w+([\.+-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(b.val())){return!0}alert(f.strings[0]);b.val("");return!1},waiter:function waiter(){return"<div class=\"ajax-waiter\"><center><img src=\""+c.wwwroot+"/local/shop/pix/loading29.gif\" /><center></div>"},open_popup:function open_popup(b){var c=a(this),b=c.attr("data-target");window.open(b,"product","width=400,height=500,toolbar=0,menubar=0,statusbar=0")},openSalesPopup:function openSalesPopup(){window.open(c.wwwroot+"/local/shop/popup.php?p=sales","sales","width=600,height=600,toolbar=0,menubar=0,statusbar=0, resizable=1,scrollbars=1")}};return f});
//# sourceMappingURL=front.min.js.map
