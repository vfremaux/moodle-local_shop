{"version":3,"file":"editmetadata.min.js","sources":["../src/editmetadata.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n// jshint unused: true, undef:true\n\ndefine(['jquery', 'core/log'], function($, log) {\n\n    var shopmetadataedit = {\n\n        /**\n         * Initiates, placing events handler in content.\n         */\n        init: function() {\n            $('input[name=\"editextradata\"]').bind('click', this.openeditmodal);\n            $('input[name=\"editproductiondata\"]').bind('click', this.openeditmodal);\n            $('input[name=\"edithandlerparams\"]').bind('click', this.openeditmodal);\n            log.debug(\"Local Shop AMD Editmetadata Initialized !\");\n        },\n\n        /**\n         * Parses the textarea content and extracts property:value pairs.\n         * @param {string[]} values\n         * @param {string} [format]\n         */\n        parsevalues: function(values, format) {\n            var arr, part, parts, valuearr = [];\n\n            if (format === 'json') {\n                // Jsonified format as {\"key1\":\"val1\", \"key2\":\"val2\",...}\n                valuearr = JSON.parse(values);\n            } else {\n                // Url encoded format as key1=val1&key1=val2... etc.\n                parts = values.split('&');\n                for (part in parts) {\n                    arr = parts[part].split('=');\n                    valuearr[arr[0]] = arr[1];\n                }\n            }\n\n            return valuearr;\n        },\n\n        /**\n         * Recombines property::value array into the text area content.\n         * @param {string[]} values\n         * @param {string} [format]\n         */\n        recombinevalues: function(values, format) {\n            var val;\n            var valueparts = [];\n\n            if (format === 'json') {\n                // Jsonified format as {\"key1\":\"val1\", \"key2\":\"val2\",...}\n                return JSON.stringify(values);\n            } else {\n                // Url encoded format as key1=val1&key1=val2... etc.\n                for (val in values) {\n                    valueparts.push(val + '=' + values[val]);\n                }\n                return valueparts.join('&');\n            }\n        },\n\n        /**\n         * Opens modal and build a local form from textarea value.\n         * @param {Object} e - the event\n         */\n        openeditmodal: function(e) {\n\n            e.stopPropagation();\n            e.preventDefault();\n\n            log.debug(\"Opening modal for metadatas.\");\n\n            var that = $(this);\n            var row;\n            var rowname;\n            var rowinput;\n            var closebtn;\n            var theform = $('#metadata-edit-modal-form');\n            var themodal = $('#metadata-edit-modal-container');\n            var associatedtextarea = $('[data-edithandle=' + that.attr('id') + ']');\n            var format = associatedtextarea.attr('data-format');\n            var values = shopmetadataedit.parsevalues(associatedtextarea.val(), format);\n            var valkey;\n\n            log.debug('Detected format is ' + format + '.');\n\n            for (valkey in values) {\n                row = $('<div/>', {\n                    'class': 'mtd-row'\n                });\n                rowname = $('<div class=\"mtd-name\">' + valkey + '</div>');\n                rowinput = $('<div/>');\n                rowinput.append($('<input/>', {\n                    type: 'text',\n                    size: 80,\n                    value: values[valkey],\n                    placeholder: valkey,\n                    name: valkey\n                }));\n                row.append(rowname).append(rowinput);\n                theform.append(row);\n            }\n\n            row = $('<div/>', {\n                'class': 'mtd-row'\n            });\n            rowname = $('<div/>');\n            rowname.append($('<input/>', {\n                type: 'text',\n                value: '',\n                placeholder: 'New key',\n                name: 'newkey'\n            }));\n            rowinput = $('<div/>');\n            rowinput.append($('<input/>', {\n                type: 'text',\n                value: '',\n                size: 80,\n                placeholder: 'New value',\n                name: 'newval'\n            }));\n            row.append(rowname).append(rowinput);\n            theform.append(row);\n\n            row = $('<div/>', {\n                'class': 'mtd-row'\n            });\n            closebtn = $('<div/>');\n            closebtn.append($('<input/>', {\n                type: 'button',\n                id: 'mtd-close',\n                value: 'Save',\n                'data-format': format,\n                'data-for': associatedtextarea.attr('id'),\n                'class': 'btn btn-primary'\n            }));\n            closebtn.append($('<input/>', {\n                type: 'button',\n                id: 'mtd-cancel',\n                value: 'Cancel',\n                'data-format': format,\n                'data-for': associatedtextarea.attr('id'),\n                'class': 'btn btn-primary'\n            }));\n            row.append($('<div/>')).append(closebtn);\n            theform.append(row);\n            $('#mtd-close').bind('click', shopmetadataedit.closeeditmodal);\n            $('#mtd-cancel').bind('click', shopmetadataedit.canceleditmodal);\n            themodal.css('display', 'block');\n        },\n\n        /**\n         * Closes without saving.\n         * @param {Object} e - the event\n         */\n        canceleditmodal: function(e) {\n\n            var themodal = $('#metadata-edit-modal-container');\n            var theform = $('#metadata-edit-modal-form');\n\n            e.stopPropagation();\n            e.preventDefault();\n\n            theform.empty();\n            themodal.css('display', 'none');\n        },\n\n        /**\n         * Saves back metadata and closes helper modal.\n         * @param {Object} e - the event\n         */\n        closeeditmodal: function(e) {\n\n            e.stopPropagation();\n            e.preventDefault();\n\n            var that = $(this);\n            var themodal = $('#metadata-edit-modal-container');\n            var theform = $('#metadata-edit-modal-form');\n            var valuebuf;\n            var format = that.attr('data-format');\n            var newkey, newval;\n\n            // Search all inputs in form.\n            var inputs = $('input[type=\"text\"]', theform);\n\n            valuebuf = new Object();\n            inputs.each(function () {\n                if ($(this).attr('name') === 'newkey') {\n                    newkey = $(this).val();\n                } else if ($(this).attr('name') === 'newval') {\n                    newval = $(this).val();\n                } else {\n                    valuebuf[$(this).attr('name')] = $(this).val();\n                }\n            });\n            if (newkey) {\n                valuebuf[newkey] = newval;\n            }\n\n            $('#' + that.attr('data-for')).val(shopmetadataedit.recombinevalues(valuebuf, format));\n            theform.empty();\n            themodal.css('display', 'none');\n        }\n    };\n\n    return shopmetadataedit;\n});\n"],"names":["define","$","log","shopmetadataedit","init","bind","this","openeditmodal","debug","parsevalues","values","format","arr","part","parts","valuearr","JSON","parse","split","recombinevalues","val","valueparts","stringify","push","join","e","stopPropagation","preventDefault","row","rowname","rowinput","closebtn","valkey","that","theform","themodal","associatedtextarea","attr","append","type","size","value","placeholder","name","id","closeeditmodal","canceleditmodal","css","empty","valuebuf","newkey","newval","inputs","Object","each"],"mappings":"AAiBAA,iCAAO,CAAC,SAAU,aAAa,SAASC,EAAGC,SAEnCC,iBAAmB,CAKnBC,KAAM,WACFH,EAAE,+BAA+BI,KAAK,QAASC,KAAKC,eACpDN,EAAE,oCAAoCI,KAAK,QAASC,KAAKC,eACzDN,EAAE,mCAAmCI,KAAK,QAASC,KAAKC,eACxDL,IAAIM,MAAM,8CAQdC,YAAa,SAASC,OAAQC,YACtBC,IAAKC,KAAMC,MAAOC,SAAW,MAElB,SAAXJ,OAEAI,SAAWC,KAAKC,MAAMP,iBAIjBG,QADLC,MAAQJ,OAAOQ,MAAM,KAGjBH,UADAH,IAAME,MAAMD,MAAMK,MAAM,MACX,IAAMN,IAAI,UAIxBG,UAQXI,gBAAiB,SAAST,OAAQC,YAC1BS,IACAC,WAAa,MAEF,SAAXV,cAEOK,KAAKM,UAAUZ,YAGjBU,OAAOV,OACRW,WAAWE,KAAKH,IAAM,IAAMV,OAAOU,aAEhCC,WAAWG,KAAK,MAQ/BjB,cAAe,SAASkB,GAEpBA,EAAEC,kBACFD,EAAEE,iBAEFzB,IAAIM,MAAM,oCAGNoB,IACAC,QACAC,SACAC,SAMAC,OAVAC,KAAOhC,EAAEK,MAKT4B,QAAUjC,EAAE,6BACZkC,SAAWlC,EAAE,kCACbmC,mBAAqBnC,EAAE,oBAAsBgC,KAAKI,KAAK,MAAQ,KAC/D1B,OAASyB,mBAAmBC,KAAK,eACjC3B,OAASP,iBAAiBM,YAAY2B,mBAAmBhB,MAAOT,YAK/DqB,UAFL9B,IAAIM,MAAM,sBAAwBG,OAAS,KAE5BD,OACXkB,IAAM3B,EAAE,SAAU,OACL,YAEb4B,QAAU5B,EAAE,yBAA2B+B,OAAS,WAChDF,SAAW7B,EAAE,WACJqC,OAAOrC,EAAE,WAAY,CAC1BsC,KAAM,OACNC,KAAM,GACNC,MAAO/B,OAAOsB,QACdU,YAAaV,OACbW,KAAMX,UAEVJ,IAAIU,OAAOT,SAASS,OAAOR,UAC3BI,QAAQI,OAAOV,KAGnBA,IAAM3B,EAAE,SAAU,OACL,aAEb4B,QAAU5B,EAAE,WACJqC,OAAOrC,EAAE,WAAY,CACzBsC,KAAM,OACNE,MAAO,GACPC,YAAa,UACbC,KAAM,aAEVb,SAAW7B,EAAE,WACJqC,OAAOrC,EAAE,WAAY,CAC1BsC,KAAM,OACNE,MAAO,GACPD,KAAM,GACNE,YAAa,YACbC,KAAM,YAEVf,IAAIU,OAAOT,SAASS,OAAOR,UAC3BI,QAAQI,OAAOV,KAEfA,IAAM3B,EAAE,SAAU,OACL,aAEb8B,SAAW9B,EAAE,WACJqC,OAAOrC,EAAE,WAAY,CAC1BsC,KAAM,SACNK,GAAI,YACJH,MAAO,qBACQ9B,kBACHyB,mBAAmBC,KAAK,YAC3B,qBAEbN,SAASO,OAAOrC,EAAE,WAAY,CAC1BsC,KAAM,SACNK,GAAI,aACJH,MAAO,uBACQ9B,kBACHyB,mBAAmBC,KAAK,YAC3B,qBAEbT,IAAIU,OAAOrC,EAAE,WAAWqC,OAAOP,UAC/BG,QAAQI,OAAOV,KACf3B,EAAE,cAAcI,KAAK,QAASF,iBAAiB0C,gBAC/C5C,EAAE,eAAeI,KAAK,QAASF,iBAAiB2C,iBAChDX,SAASY,IAAI,UAAW,UAO5BD,gBAAiB,SAASrB,OAElBU,SAAWlC,EAAE,kCACbiC,QAAUjC,EAAE,6BAEhBwB,EAAEC,kBACFD,EAAEE,iBAEFO,QAAQc,QACRb,SAASY,IAAI,UAAW,SAO5BF,eAAgB,SAASpB,GAErBA,EAAEC,kBACFD,EAAEE,qBAKEsB,SAEAC,OAAQC,OALRlB,KAAOhC,EAAEK,MACT6B,SAAWlC,EAAE,kCACbiC,QAAUjC,EAAE,6BAEZU,OAASsB,KAAKI,KAAK,eAInBe,OAASnD,EAAE,qBAAsBiC,SAErCe,SAAW,IAAII,OACfD,OAAOE,MAAK,WACqB,WAAzBrD,EAAEK,MAAM+B,KAAK,QACba,OAASjD,EAAEK,MAAMc,MACe,WAAzBnB,EAAEK,MAAM+B,KAAK,QACpBc,OAASlD,EAAEK,MAAMc,MAEjB6B,SAAShD,EAAEK,MAAM+B,KAAK,SAAWpC,EAAEK,MAAMc,SAG7C8B,SACAD,SAASC,QAAUC,QAGvBlD,EAAE,IAAMgC,KAAKI,KAAK,aAAajB,IAAIjB,iBAAiBgB,gBAAgB8B,SAAUtC,SAC9EuB,QAAQc,QACRb,SAASY,IAAI,UAAW,iBAIzB5C"}