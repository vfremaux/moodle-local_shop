<?php
/*   __________________________________________________
    |              on 2.0.12              |
    |__________________________________________________|
*/
 namespace local_shop; defined("\115\117\x4f\104\114\x45\x5f\111\116\124\x45\122\x4e\x41\114") || die; require_once $CFG->dirroot . "\57\x6c\x6f\143\141\x6c\57\x73\x68\x6f\160\x2f\160\162\x6f\x2f\143\x6c\141\163\163\x65\163\57\115\165\x6c\164\151\x70\154\x65\117\146\x66\145\x72\x43\157\x64\x65\104\x69\x73\143\x6f\165\156\164\x2e\x63\154\x61\163\x73\56\x70\x68\160"; require_once $CFG->dirroot . "\57\x6c\x6f\143\x61\x6c\x2f\163\150\x6f\160\57\160\x72\x6f\57\x63\x6c\x61\x73\x73\x65\x73\57\x50\x61\162\x74\156\145\162\x2e\x63\x6c\x61\163\163\x2e\x70\x68\160"; use StdClass; use context_system; use local_shop\Partner; class PartnerMultipleOfferCodeDiscount extends MultipleOfferCodeDiscount { public function check_applicability(&$qQ0hv = null) { goto y0Qrr; Bj2aM: $syuG8->code = $this->thecode; goto Ew3vy; k5SD6: return false; goto zca47; rdutJ: return false; goto dU3uB; taTc6: $this->ratio = $this->codes[$this->thecode]->ratio; goto Z8nVd; uEqCp: $lWyz5->partnerkey = $this->codes[$this->thecode]->partnerkey; goto kst3T; B7ron: $syuG8 = new StdClass(); goto Bj2aM; dU3uB: oYZ7_: goto nX5_y; PDK37: $this->get_codes(); goto vBhH6; t2jLE: Partner::register_in_bill($qQ0hv, $lWyz5); goto pr7p5; kst3T: $lWyz5->partnertag = $this->thecode; goto hVxul; Z8nVd: $lWyz5 = new StdClass(); goto uEqCp; VCI1d: $this->thecode = $SESSION->shoppingcart->discountcodes[$this->id]; goto FMLsx; zm7AY: return false; goto Gq0gx; bvGpC: $this->checked = true; goto PDK37; y0Qrr: global $SESSION; goto bvGpC; Gq0gx: ZhRJC: goto VCI1d; JAvOo: $this->productiondata = $syuG8; goto bXxGS; bXxGS: $this->checked = true; goto dqaIg; nX5_y: if (!empty($SESSION->shoppingcart->discountcodes[$this->id])) { goto ZhRJC; } goto zm7AY; pr7p5: shop_debug_trace("\120\141\x72\x74\x6e\x65\162\40\x72\145\x67\151\163\x74\145\x72\145\x64\40\x69\156\40\142\151\x6c\154\x20{$qQ0hv->id}", SHOP_TRACE_DEBUG_FINE); goto z2tsw; z2tsw: pE7L4: goto B7ron; dqaIg: return true; goto aqFkz; Ew3vy: $syuG8->ratio = $this->ratio; goto JAvOo; vBhH6: if (!empty($this->codes)) { goto oYZ7_; } goto rdutJ; FMLsx: if (in_array($this->thecode, array_keys($this->codes))) { goto pfQ45; } goto k5SD6; zca47: pfQ45: goto taTc6; hVxul: if (is_null($qQ0hv)) { goto pE7L4; } goto t2jLE; aqFkz: } public function preview_applicability() { return $this->check_applicability(); } public function is_interactive_eligible() { goto N7Uum; Vs6Oj: if (empty($this->applyondata)) { goto iWBbo; } goto Q5m4H; VLQjt: return false; goto HrAAT; hNiFe: if (!($this->applyon == "\151\x74\145\x6d\x6c\151\x73\x74")) { goto ET4uj; } goto Vs6Oj; l05lT: return true; goto npRYR; N7Uum: global $SESSION; goto hNiFe; HrAAT: iWBbo: goto AvEzh; QnaF4: lhvE4: goto VLQjt; cQ8tM: foreach ($ITZWc as $Pj6uN) { goto YcqEI; YcqEI: if (!in_array(trim($Pj6uN), array_keys($SESSION->shoppingcart->order))) { goto X3sjc; } goto IT6dV; IT6dV: return true; goto boWsP; OsG0C: P5e3g: goto o1uDg; boWsP: X3sjc: goto OsG0C; o1uDg: } goto QnaF4; AvEzh: ET4uj: goto l05lT; Q5m4H: $ITZWc = explode("\x2c", $this->applyondata); goto cQ8tM; npRYR: } public function is_interactive_verified() { goto zn8A0; zn8A0: global $SESSION; goto hu_UA; s7B0L: um2C1: goto lfqLR; SgGn8: bgcce: goto fUmFB; COn22: if (!in_array($xHODM, array_keys($this->codes))) { goto um2C1; } goto Vczj2; GagXl: $SESSION->shoppingcart->discountcodes = []; goto ahRMu; in4Lv: return false; goto SgGn8; z13Jc: if (!empty($SESSION->shoppingcart)) { goto A349E; } goto Twngv; ahRMu: mfsyE: goto oxNc7; Vczj2: $this->ratio = $this->codes[$xHODM]->ratio; goto Goric; RPkxM: if (!empty($SESSION->shoppingcart->discountcodes)) { goto mfsyE; } goto GagXl; hu_UA: if ($this->is_interactive_eligible()) { goto bgcce; } goto in4Lv; BpglL: return false; goto WC7SH; oxNc7: if (empty($SESSION->shoppingcart->discountcodes[$this->id])) { goto VC9AF; } goto LIPMl; fUmFB: $this->get_codes(); goto z13Jc; KdiqE: A349E: goto RPkxM; LIPMl: $xHODM = $SESSION->shoppingcart->discountcodes[$this->id]; goto COn22; lfqLR: VC9AF: goto BpglL; Twngv: $SESSION->shoppingcart = new StdClass(); goto KdiqE; Goric: return true; goto s7B0L; WC7SH: } public function has_multiple_ratios() { return true; } protected function get_codes() { goto ue1kQ; oLPjp: $coM6y = preg_split("\57\133\x5c\163\54\x5d\x2b\57", $this->ruledata); goto evqnz; dQ_CS: WiChK: goto fROH3; fROH3: D8Yt6: goto DhGFO; G8a2y: foreach ($coM6y as $zb2og) { goto tKnXe; k4x5x: $this->codes[$J0nx7] = $m7rI2; goto Kz9NF; Kz9NF: l6U1u: goto w_YS3; irutq: $m7rI2->partnerkey = $kWos7; goto k4x5x; gFETn: $m7rI2->code = $J0nx7; goto xygZb; UoJbD: $m7rI2 = new StdClass(); goto gFETn; xygZb: $m7rI2->ratio = $p8Q9C; goto irutq; tKnXe: list($J0nx7, $p8Q9C, $kWos7) = explode("\174", $zb2og); goto UoJbD; w_YS3: } goto dQ_CS; ue1kQ: if (isset($this->codes)) { goto D8Yt6; } goto oLPjp; evqnz: $this->codes = []; goto G8a2y; DhGFO: } protected function check_ruledata($lWyz5) { goto o6eFz; rOm3x: O8GWv: goto uVZtO; xXi4H: $VZzZu = []; goto i1gRA; i1gRA: foreach ($coM6y as $zb2og) { goto UI0fk; NKGrV: $drPdi = explode("\174", $zb2og); goto jEr4D; W1ytH: if ($DB->record_exists("\x6c\157\143\141\154\137\x73\x68\157\160\x5f\160\141\162\x74\156\145\162", ["\160\x61\162\164\156\x65\x72\x6b\x65\x79" => $drPdi[2]])) { goto u_Aee; } goto CSff0; jEr4D: if (!(count($drPdi) != 3)) { goto l9esN; } goto ZxRGy; ZxRGy: return get_string("\x64\x69\x73\x63\x6f\165\156\164\145\x72\162\x6f\x72\x3a\156\x6f\x74\145\156\157\165\x67\x68\141\162\147\165\155\145\156\164\x73", "\154\157\143\141\x6c\137\x73\x68\x6f\160"); goto SaUH1; CZQHf: Eccry: goto NKGrV; QKqui: WhUca: goto W1ytH; UI0fk: if (!empty(trim($zb2og))) { goto Eccry; } goto fZZsG; CSff0: return get_string("\144\151\163\143\x6f\x75\x6e\x74\145\162\x72\x6f\x72\72\142\141\144\160\141\x72\x74\x6e\x65\x72\153\145\171", "\154\157\x63\x61\154\137\x73\150\157\x70"); goto PCMM5; wMr5R: return get_string("\x64\x69\163\x63\x6f\165\x6e\164\x65\x72\x72\157\162\72\x65\155\x70\164\171\143\157\x64\145", "\x6c\x6f\143\x61\154\137\x73\x68\157\x70"); goto ptWMJ; SaUH1: l9esN: goto HSIR3; ptWMJ: Wcg1l: goto E4Msk; x0v7T: return get_string("\144\x69\163\x63\157\165\x6e\164\x65\162\x72\157\162\x3a\x62\141\x64\162\x61\164\x69\x6f\146\x6f\162\x6d\141\x74", "\154\x6f\143\x61\x6c\137\x73\150\157\160"); goto QKqui; HSIR3: if (empty($drPdi[0])) { goto Wcg1l; } goto wMr5R; E4Msk: if (is_numeric($drPdi[1])) { goto WhUca; } goto x0v7T; bPzcg: gGWyp: goto Bn76s; PCMM5: u_Aee: goto bPzcg; fZZsG: goto gGWyp; goto CZQHf; Bn76s: } goto rOm3x; PlnTo: $coM6y = explode("\54", $lWyz5->ruledata); goto xXi4H; uVZtO: return false; goto JHMqA; o6eFz: global $DB; goto PlnTo; JHMqA: } }
