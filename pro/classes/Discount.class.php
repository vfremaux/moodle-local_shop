<?php
/*   __________________________________________________
    |              on 2.0.12              |
    |__________________________________________________|
*/
 namespace local_shop; defined("\x4d\117\x4f\x44\x4c\x45\137\x49\116\x54\x45\122\x4e\101\114") || die; require_once $CFG->dirroot . "\57\154\157\143\x61\154\x2f\163\x68\x6f\160\x2f\143\154\141\x73\163\145\x73\57\123\150\x6f\160\117\x62\x6a\x65\143\164\x2e\143\154\141\163\163\56\x70\150\x70"; require_once $CFG->dirroot . "\x2f\x6c\x6f\x63\141\154\x2f\163\x68\157\x70\57\x63\154\x61\x73\x73\145\163\x2f\x42\151\x6c\154\56\x63\x6c\x61\163\163\56\x70\x68\160"; require_once $CFG->dirroot . "\x2f\154\157\143\141\154\57\163\x68\x6f\x70\57\x63\154\141\163\x73\x65\163\57\x42\x69\154\x6c\x49\164\145\x6d\56\143\x6c\x61\x73\163\56\x70\x68\x70"; use StdClass; abstract class Discount extends ShopObject { public const APPLY_ON_FULL_BILL = "\x62\151\154\154"; public const APPLY_ON_ITEM_LIST = "\x69\x74\x65\155\154\151\x73\x74"; public static $table = "\154\157\143\x61\154\137\x73\x68\x6f\160\x5f\x64\x69\x73\143\x6f\165\156\164"; public $ratio; protected function __construct($eKsrJ, $b92uN = false) { goto Sho46; nqA6R: $this->ratio = $this->record->ratio; goto aFn4v; aFn4v: if (!$b92uN) { goto C86a3; } goto bBmte; bBmte: return; goto AW5Yd; AW5Yd: C86a3: goto NEXn1; NEXn1: $this->bills = self::get_bill_instances($this->id); goto gzPRa; oBo7r: parent::__construct($eKsrJ, self::$table); goto jZkfE; jZkfE: $this->productiondata = new StdClass(); goto nqA6R; Sho46: global $CFG; goto oBo7r; gzPRa: } public function set_productiondata($syuG8) { goto XmcI2; ogEMb: MKE5Z: goto JWoSw; dU2tK: $this->ratio = $this->productiondata->ratio; goto vu_Bt; dhXWX: if (isset($this->productiondata->ratio)) { goto iptVa; } goto BisMB; pb50k: iptVa: goto dU2tK; vu_Bt: hJoFL: goto ogEMb; BisMB: $this->ratio = $this->record->ratio; goto iFA6H; XmcI2: $this->productiondata = $syuG8; goto lILIL; iFA6H: goto hJoFL; goto pb50k; lILIL: if (empty($this->productiondata)) { goto MKE5Z; } goto dhXWX; JWoSw: } public static function instance($LaGHc) { goto HEWw7; Kvx2v: if (!empty($YAYD0)) { goto CtRZ1; } goto qQtBQ; WQHUT: return new $vqxXu($LaGHc); goto yCEro; kYcTx: $YAYD0 = $LaGHc->type; goto Kvx2v; ynN_P: if (is_object($LaGHc)) { goto J54M_; } goto N9Ilx; OWgHZ: include_once $CFG->dirroot . "\x2f\154\157\143\141\154\x2f\163\x68\x6f\160\57\x70\x72\157\57\x63\x6c\141\x73\163\145\163\57" . $vqxXu . "\56\x63\x6c\141\x73\163\56\160\150\160"; goto rovZn; qQtBQ: throw new \coding_exception("\104\151\x73\x63\x6f\x75\x6e\164\40\164\171\160\145\x20\x63\x61\x6e\x6e\x6f\x74\x20\142\145\40\145\155\x70\164\x79\xa\x73\x6f\x75\162\143\145\40\x64\x61\164\141\40\151\x73\x20" . print_r($LaGHc, true)); goto EoMqj; ieugr: return null; goto IFZYY; IFZYY: U1KT7: goto nMDA9; eNfyk: J54M_: goto kYcTx; q1LpE: throw new \coding_exception("\104\151\163\x63\x6f\165\156\x74\40\x73\150\157\x70\151\144\x20\143\x61\156\x6e\157\x74\40\x62\145\x20\145\155\x70\x74\x79\xa\163\x6f\x75\162\x63\145\40\x64\x61\164\x61\x20\x69\x73\40" . print_r($LaGHc, true)); goto ANHVV; HEWw7: global $DB, $CFG; goto ynN_P; VG73E: goto ihiIs; goto eNfyk; N9Ilx: $YAYD0 = $DB->get_field("\154\x6f\143\141\154\137\x73\x68\x6f\160\x5f\144\x69\163\x63\157\165\x6e\164", "\164\171\160\x65", ["\x69\144" => $LaGHc]); goto VG73E; viyKW: if (!empty($YAYD0)) { goto U1KT7; } goto ieugr; ANHVV: ZRKeA: goto Lh02a; Lh02a: ihiIs: goto viyKW; UwVZG: if (!empty($LaGHc->shopid)) { goto ZRKeA; } goto q1LpE; rovZn: $vqxXu = "\x5c\154\157\x63\141\154\137\x73\150\x6f\160\134" . $vqxXu; goto WQHUT; EoMqj: CtRZ1: goto UwVZG; nMDA9: $vqxXu = $YAYD0 . "\104\151\163\143\157\x75\156\164"; goto OWgHZ; yCEro: } public static function preview_discount_in_session($iaM56, $sB01b = false) { goto jWY03; rBr2p: $otdOL = new StdClass(); goto OD5C6; NUf56: if (empty($wK0nf)) { goto TG3jl; } goto E46k4; l1nT4: eeDks: goto QAP7v; ZE7_3: SakH2: goto xIWTC; OD5C6: $otdOL->ispartial = 0; goto JJ3ar; fqcMo: $FekXj = []; goto NUf56; wf1F6: $otdOL->untaxeddiscount = 0; goto WkhoP; bQddw: $wK0nf = self::get_applicable_discounts($iaM56->id); goto h_YIl; E46k4: foreach ($wK0nf as $J8_tB) { goto ZkWwA; xRw0z: g1zYk: goto DQbOa; cjZEr: aftsi: goto Kq_bB; CTam1: if ($XKnqh) { goto rggld; } goto DBoPq; szg_S: rggld: goto ZFHbo; K5evs: if (!($XKnqh->ispartial && !$otdOL->ispartial)) { goto sDOne; } goto EX_A2; KzXhR: $otdOL->reason = ''; goto cjZEr; Diby4: a91sg: goto IQwP1; ZkWwA: $XKnqh = $J8_tB->preview($DfZgU); goto CTam1; BcRQ2: foreach ($XKnqh->discounttaxes as $zACQh => $j11Vu) { goto YojMw; zi1dL: BftG8: goto ZMAEt; jyAoA: zLv0V: goto XuSxP; XuSxP: UFBHd: goto a20yJ; YojMw: if (!array_key_exists($zACQh, $otdOL->discounttaxes)) { goto BftG8; } goto b8oUp; ZMAEt: $otdOL->discounttaxes[$zACQh] = $j11Vu; goto jyAoA; PAAjd: goto zLv0V; goto zi1dL; b8oUp: $otdOL->discounttaxes[$zACQh] += $j11Vu; goto PAAjd; a20yJ: } goto Diby4; IQwP1: $otdOL->untaxeddiscount += $XKnqh->untaxeddiscount; goto K5evs; AAqg6: $otdOL->discount = 0; goto KzXhR; Kq_bB: $FekXj[] = $J8_tB->ratio; goto NavH1; DQbOa: WW6rX: goto yn0e6; DBoPq: goto WW6rX; goto szg_S; NavH1: $otdOL->discount += $XKnqh->discount; goto Xkdtf; OrTZ1: $FekXj = []; goto AAqg6; VyAQo: $otdOL->discounts[] = $XKnqh; goto bDkIM; ZFHbo: if (!($J8_tB->operator == "\x74\x61\x6b\145\x6f\166\x65\x72")) { goto aftsi; } goto OrTZ1; EX_A2: $otdOL->ispartial = true; goto cB_MJ; Xkdtf: $otdOL->discounttax += $XKnqh->discounttax; goto BcRQ2; SJopR: goto eeDks; goto xRw0z; bDkIM: if (!($J8_tB->operator == "\x74\141\x6b\145\x6f\166\x65\162")) { goto g1zYk; } goto SJopR; cB_MJ: sDOne: goto VyAQo; yn0e6: } goto l1nT4; ejF43: $otdOL->discounttax = 0; goto wf1F6; wS7a2: static $otdOL; goto yYM2P; jWY03: global $SESSION; goto wS7a2; UqdoX: ysv57: goto rBr2p; mqHQ4: $otdOL->discount = 0; goto ejF43; AH4UE: return $otdOL; goto UqdoX; vUXfH: return false; goto ZE7_3; h_YIl: $DfZgU = $iaM56->get_catalogue(); goto fqcMo; J9HJO: return $otdOL; goto yAgL6; JJ3ar: $otdOL->reason = ''; goto mqHQ4; Q5QOB: $otdOL->discounttaxes = []; goto hXzMf; yYM2P: if (!empty($SESSION->shoppingcart)) { goto SakH2; } goto vUXfH; WkhoP: if (!empty($otdOL->discounttaxes)) { goto Q3kFA; } goto Q5QOB; WqYSh: TG3jl: goto J9HJO; cLCDw: $otdOL->ratio = $wk3nX ? array_sum($FekXj) / $wk3nX : 0; goto WqYSh; QAP7v: $wk3nX = count($FekXj); goto cLCDw; xIWTC: if (!(!empty($otdOL) && !$sB01b)) { goto ysv57; } goto AH4UE; hXzMf: Q3kFA: goto bQddw; yAgL6: } public function get_discount_tax($zACQh) { global $SESSION; return @$SESSION->shoppingcart->discounttaxes[$zACQh]; } public static function get_bill_instances($ptVwY) { goto G3Oer; sTj_w: $JXfYP = []; goto kpi_z; G3Oer: global $DB; goto iVB7W; kpi_z: foreach ($Y30uH as $J8_tB) { $JXfYP[$J8_tB->billid] = true; fr5sG: } goto nGONe; iVB7W: $Y30uH = $DB->get_records("\x6c\157\x63\141\x6c\137\x73\x68\157\160\x5f\142\151\x6c\154\x69\164\x65\x6d", ["\x74\171\160\x65" => "\104\111\x53\103\x4f\125\x4e\x54", "\x69\164\145\x6d\143\x6f\144\145" => "\x44" . $ptVwY]); goto sTj_w; nGONe: RSW0R: goto lklhA; lklhA: $JXfYP = array_keys($JXfYP); goto gox58; gox58: return null; goto HLq0S; HLq0S: } public static function get_applicable_discounts($ue9Tk) { goto lXQnx; SFHoj: return $wK0nf; goto dFZIt; aBpGK: if (empty($GiDU8)) { goto FuIad; } goto T7dGP; bnJjo: $wK0nf = []; goto aBpGK; ODO5M: FuIad: goto SFHoj; ALvr1: kCwZn: goto ODO5M; T7dGP: foreach ($GiDU8 as $O31Q1) { goto Qv4sb; W1lLG: include_once $CFG->dirroot . "\x2f\154\x6f\143\x61\154\x2f\163\x68\x6f\x70\57\160\162\157\x2f\143\154\141\163\x73\x65\x73\57" . $vqxXu . "\x2e\x63\154\141\x73\x73\56\160\x68\160"; goto eqJfO; RJrlK: $wK0nf[$O31Q1->id] = new $vqxXu($O31Q1); goto ws9C3; Qv4sb: $vqxXu = $O31Q1->type . "\x44\x69\x73\x63\x6f\165\x6e\164"; goto W1lLG; ws9C3: Iaz8R: goto QL1iE; eqJfO: $vqxXu = "\134\x6c\x6f\143\141\x6c\137\x73\x68\157\160\x5c" . $vqxXu; goto RJrlK; QL1iE: } goto ALvr1; ZIwrH: $GiDU8 = $DB->get_records("\154\x6f\143\141\x6c\137\x73\x68\157\160\137\x64\x69\x73\143\x6f\x75\x6e\164", ["\x73\x68\x6f\x70\151\144" => $ue9Tk, "\145\x6e\x61\x62\x6c\x65\x64" => 1], "\157\162\x64\145\162\151\156\x67"); goto bnJjo; lXQnx: global $DB, $CFG; goto ZIwrH; dFZIt: } public static function get_instances_for_admin($ue9Tk) { goto Y1V9Z; fpJHb: M7oOT: goto eLjH8; x2zJH: x9RPU: goto fpJHb; TSuQc: $wK0nf = []; goto ER78V; Y1V9Z: global $DB, $CFG; goto MsCY5; jVsr3: foreach ($GiDU8 as $O31Q1) { goto StYNv; Pvt2z: $vqxXu = "\x5c\x6c\157\x63\141\154\137\x73\x68\157\x70\x5c" . $vqxXu; goto ovFjl; ovFjl: $wK0nf[$O31Q1->id] = new $vqxXu($O31Q1); goto ggJaX; fMt6h: include_once $CFG->dirroot . "\x2f\154\157\x63\141\x6c\x2f\163\150\x6f\x70\x2f\x70\x72\x6f\x2f\143\154\x61\163\163\x65\163\57" . $vqxXu . "\56\x63\154\x61\x73\x73\x2e\x70\x68\x70"; goto Pvt2z; ggJaX: flgWa: goto AX5Mk; StYNv: $vqxXu = $O31Q1->type . "\x44\x69\x73\143\157\x75\x6e\164"; goto fMt6h; AX5Mk: } goto x2zJH; MsCY5: $GiDU8 = $DB->get_records("\154\x6f\x63\141\x6c\137\x73\150\157\x70\137\144\151\x73\x63\x6f\165\156\x74", ["\163\x68\157\x70\x69\x64" => $ue9Tk], "\157\162\x64\x65\162\151\156\x67"); goto TSuQc; eLjH8: return $wK0nf; goto peIWs; ER78V: if (empty($GiDU8)) { goto M7oOT; } goto jVsr3; peIWs: } public abstract function check_applicability(&$qQ0hv = null); public abstract function preview_applicability(); public function preview($DfZgU) { goto zUYh1; cxXUO: return $XKnqh; goto YFsD5; ISyWF: BdOMM: goto r_QCU; upHF5: $XKnqh->untaxeddiscount = $R8ixF * $this->ratio / 100; goto MJMW3; kfQ1q: $XKnqh = new StdClass(); goto nl5kO; r_QCU: Gol64: goto OXrco; zWaDI: return false; goto lTjVE; mzrbN: $ITZWc = explode("\54", $i4MLD); goto f59rM; zKJDH: $XKnqh->reason = $this->name; goto cxXUO; TgDfc: if (!empty($i4MLD)) { goto x081a; } goto YObMK; LsbTe: i7Rcl: goto ltPUG; PPju9: $i4MLD = $this->applydata; goto TgDfc; MJMW3: $XKnqh->discounttax = $efaje * $this->ratio / 100; goto zKJDH; ou46W: hbIcB: goto NqWwh; qe1Kn: if ($this->preview_applicability()) { goto LvZVa; } goto Vavgr; qvrfv: $DCQyp = 0; goto uEc3_; nl5kO: $XKnqh->ispartial = false; goto k_xnW; f59rM: foreach ($ITZWc as $Pj6uN) { $n4dSV[] = trim($Pj6uN); RRWsi: } goto ISyWF; lYHcE: $n4dSV = []; goto PPju9; RACu6: if (!($this->applyon == "\151\x74\145\155\154\x69\x73\x74")) { goto UThte; } goto lYHcE; PQJv4: BKDUG: goto zWaDI; rTYjW: $XKnqh->discount = $DCQyp * $this->ratio / 100; goto upHF5; Pi3Sr: return false; goto eZiO1; m4GJ3: foreach ($SESSION->shoppingcart->order as $QT_UE => $Te4Wz) { goto MDsvn; SaZ7t: $efaje += $icqwQ; goto YgAIo; Jl3t_: Ql3f3: goto Us32_; f2TpW: $icqwQ = $DoMNU->get_tax($Te4Wz) * $Te4Wz; goto SaZ7t; lub6D: if (array_key_exists($DoMNU->taxcode, $XKnqh->discounttaxes)) { goto FHJGK; } goto ZI3WK; bz1Rp: $mmkGE = $DoMNU->get_taxed_price($Te4Wz) * $Te4Wz; goto BieFD; YgAIo: $r2FPH = $DoMNU->taxcode; goto erTL6; EWdJj: $R8ixF += $k7VRX; goto f2TpW; erTL6: if (empty($r2FPH)) { goto Ql3f3; } goto lub6D; Us32_: I0FWs: goto acyY7; BieFD: $k7VRX = $DoMNU->get_price($Te4Wz) * $Te4Wz; goto KXkyK; cOo4W: $DoMNU = $DfZgU->get_product_by_shortname($QT_UE); goto BvqHk; BvqHk: if (!(!empty($n4dSV) && !in_array($DoMNU->code, $n4dSV))) { goto CR2aa; } goto qo3FS; vfe3V: FHJGK: goto Kh1RN; Kh1RN: $XKnqh->discounttaxes[$DoMNU->taxcode] += $icqwQ * $this->ratio / 100; goto Jl3t_; MDsvn: $kcqdI += $Te4Wz; goto cOo4W; i9pz4: goto I0FWs; goto WklLv; qo3FS: $XKnqh->ispartial = true; goto i9pz4; ZI3WK: $XKnqh->discounttaxes[$DoMNU->taxcode] = 0; goto vfe3V; WklLv: CR2aa: goto bz1Rp; KXkyK: $DCQyp += $mmkGE; goto EWdJj; acyY7: } goto LsbTe; YObMK: if (!$gvZWe) { goto BKDUG; } goto tBJyR; zUYh1: global $SESSION, $CFG; goto j7TiO; yJAOR: if (!empty($SESSION->shoppingcart->order)) { goto hbIcB; } goto LwVsO; NqWwh: $kcqdI = 0; goto qvrfv; gax1D: echo "\104\x65\x62\165\x67\40\72\x20{$this->name}\40\151\163\40\x4e\x6f\x74\40\141\x70\160\x6c\x69\143\x61\142\x6c\x65\x3c\x62\x72\x2f\x3e"; goto SRtnW; SRtnW: a4TvG: goto Pi3Sr; uEc3_: $R8ixF = 0; goto GaFvk; GaFvk: $efaje = 0; goto m4GJ3; eZiO1: LvZVa: goto RACu6; k_xnW: $XKnqh->discounttaxes = []; goto yJAOR; b3Du5: x081a: goto mzrbN; j7TiO: $gvZWe = optional_param("\144\x65\x62\165\147", false, PARAM_BOOL); goto qe1Kn; tBJyR: echo "\x44\x65\142\165\x67\40\x3a\40{$this->name}\40\110\141\x73\40\156\157\x20\151\x74\x65\x6d\163\x20\x6c\151\x73\164\x65\144\74\x62\162\57\x3e"; goto PQJv4; Vavgr: if (!$gvZWe) { goto a4TvG; } goto gax1D; LwVsO: return; goto ou46W; lTjVE: goto Gol64; goto b3Du5; ltPUG: $XKnqh->discountrate = $this->ratio; goto rTYjW; OXrco: UThte: goto kfQ1q; YFsD5: } public function is_interactive_eligible() { goto SwBEA; odLpy: return true; goto FbJAn; kSFW6: return false; goto xLHSz; SwBEA: if (!empty($this->argument)) { goto fCsVM; } goto kSFW6; sFMuD: fCsVM: goto odLpy; xLHSz: goto kN288; goto sFMuD; FbJAn: kN288: goto A5qRR; A5qRR: } public function interactive_form() { goto pCk8H; CIQ_Q: $uBLTU->label = $this->argument; goto M9koa; Pjlhr: return ''; goto OgwI6; M9koa: return $uBLTU; goto VqgZi; VqgZi: hgtJ7: goto etfia; oVb6Q: Ztax_: goto xSuhh; xSuhh: $uBLTU = new Stdclass(); goto CIQ_Q; OgwI6: goto hgtJ7; goto oVb6Q; pCk8H: if (!empty($this->argument)) { goto Ztax_; } goto Pjlhr; etfia: } public function interactive_form_return($lWyz5, $Y8cR9 = null) { } public function export_for_template() { goto AQHte; Hq7sP: $pelcB->hasform = false; goto JgqEI; eu60j: return $pelcB; goto krQYc; JgqEI: return $pelcB; goto CASf4; JLvKQ: if (!empty($this->argument)) { goto ETL9E; } goto eu60j; Qt7C9: $pelcB->label = format_text($this->argument, $this->argumentformat); goto Hq7sP; AQHte: $pelcB = clone $this->record; goto JLvKQ; krQYc: ETL9E: goto Qt7C9; CASf4: } public function apply_to_bill(&$qQ0hv) { goto v37jA; VCQDO: foreach ($U29Z8 as &$bKMmk) { $bKMmk = trim($bKMmk); eSkuv: } goto C1wfL; VUYXB: foreach ($qQ0hv->items as $G92k3 => $gN60h) { goto PId3P; QkemW: $qQ0hv->discounttaxes += $kR9C3; goto G1ahl; e4Kgy: M1h0z: goto kjzqE; jgtHh: assert(!empty($this->checked)); goto U_MMY; U_MMY: $sJP8B = new StdClass(); goto yWg_B; N9frB: KDVxO: goto jgtHh; kjzqE: $qQ0hv->taxlines[$i73O4->taxcode] += $kR9C3; goto Q7vFz; Txhg8: $sJP8B->unitcost = -$gN60h->unitcost * $this->ratio / 100; goto FdDnj; G1ahl: if (array_key_exists($i73O4->taxcode, $qQ0hv->taxlines)) { goto M1h0z; } goto r9UJi; FdDnj: $sJP8B->quantity = $gN60h->record->quantity; goto Z1c0W; LkZYL: BfM8i: goto Dnpv0; QdpS2: $qQ0hv->items[$sJP8B->itemcode] = $i73O4; goto LOhB4; z3k8U: echo "\x44\x55\x55\x68\x74\x20" . ($sJP8B->totalprice + $kR9C3) . "\x3c\x62\x72\57\x3e"; goto JYknE; JKpxM: cn7NR: goto xIpOZ; LOhB4: if (!($CFG->debug == DEBUG_DEVELOPER && optional_param("\x63\x6f\156\164\x72\x6f\154", false, PARAM_BOOL))) { goto uj2Aq; } goto Rz1Yz; G2SIp: echo "\x44\125\165\164\40" . $gN60h->get_tax_amount() . "\74\142\162\57\x3e"; goto z3k8U; JYknE: echo "\104\125\164\x20" . $kR9C3 . "\74\x62\x72\57\76"; goto EVajf; bz6hY: echo "\104\x55\x75\x63\150\164\40" . $sJP8B->unitcost . "\x3c\142\162\57\x3e"; goto G2SIp; EVajf: echo "\104\x55\x54\164\x63\40" . $sJP8B->totalprice . "\x3c\x62\x72\57\76\x3c\x62\162\57\x3e"; goto cap5d; PnPEu: $sJP8B->totalprice = $sJP8B->unitcost * $gN60h->quantity; goto I0ZPF; r9UJi: $qQ0hv->taxlines[$i73O4->taxcode] = $kR9C3; goto MFnaL; U4DC1: $sJP8B->productiondata = json_encode($this->productiondata); goto I70Ms; Wsfzu: $sJP8B->itemcode = "\x44" . $this->id . "\137" . $gN60h->itemcode; goto msH3W; s2CQi: $sJP8B->abstract = $this->name . "\x20" . $this->ratio . "\x25"; goto e0P1N; F8F8w: goto cn7NR; goto N9frB; Dnpv0: if (!(!$uFDlC && !in_array(trim($gN60h->itemcode), $U29Z8))) { goto KDVxO; } goto F8F8w; I0ZPF: $kR9C3 = -$gN60h->get_tax_amount() * $this->ratio / 100; goto ddil9; Rz1Yz: echo "\x41\160\x70\x6c\x79\151\x6e\147\40\x64\x69\x73\143\157\x75\156\x74\74\x62\162\57\76"; goto bz6hY; xeUBj: $i73O4->save(); goto QdpS2; cap5d: uj2Aq: goto T2G9p; yWg_B: $sJP8B->type = "\x44\x49\x53\103\117\125\x4e\x54"; goto Wsfzu; CnOLW: $i73O4 = new BillItem($sJP8B, false, ["\x62\x69\154\x6c" => $qQ0hv]); goto xeUBj; msH3W: $sJP8B->catalogitem = $gN60h->catalogitem; goto Txhg8; OfSDP: $qQ0hv->discount = $qQ0hv->untaxeddiscount + $qQ0hv->discounttaxes; goto JKpxM; T2G9p: $qQ0hv->untaxeddiscount += $sJP8B->totalprice; goto QkemW; PId3P: if (!($gN60h->type == "\123\x48\x49\120\x50\111\116\x47" || $gN60h->type == "\x44\111\x53\103\x4f\x55\116\124")) { goto BfM8i; } goto N8Y0r; I70Ms: $sJP8B->customerdata = ''; goto CnOLW; ddil9: $this->productiondata->itemcode = $gN60h->itemcode; goto U4DC1; Z1c0W: $sJP8B->taxcode = $gN60h->record->taxcode; goto s2CQi; MFnaL: goto vWuBH; goto e4Kgy; Q7vFz: vWuBH: goto OfSDP; e0P1N: $sJP8B->description = ''; goto PnPEu; N8Y0r: goto cn7NR; goto LkZYL; xIpOZ: } goto mFpdx; y0hsw: UIWys: goto ckdqC; g2bTu: return; goto UR_74; C1wfL: vEGNH: goto bxAzT; mFpdx: Y8WM6: goto xBGXS; UR_74: uyp5l: goto ZqfQ_; ckdqC: if (empty($qQ0hv->items)) { goto NOvLV; } goto VUYXB; ltxEO: if (!($this->enabled == false)) { goto uyp5l; } goto g2bTu; v37jA: global $CFG; goto ltxEO; bxAzT: goto UIWys; goto ikPkd; xBGXS: NOvLV: goto LLEO2; YL9wW: $uFDlC = false; goto Bm7nM; lRgao: $uFDlC = true; goto y0hsw; ZqfQ_: if ($this->applyon == self::APPLY_ON_FULL_BILL) { goto RdNxI; } goto YL9wW; Bm7nM: $U29Z8 = explode("\54", $this->applydata); goto VCQDO; ikPkd: RdNxI: goto lRgao; LLEO2: } public static function recalculate_discounts($qQ0hv) { goto ajnvC; FrdoZ: $wK0nf = []; goto Oxlon; PUkhu: $mHxWO = []; goto OZZDd; JgyRy: mlCbf: goto OYfpn; wXJuo: nMwTa: goto HqIAU; uBnly: EvZ4h: goto pgyzS; OZZDd: if (empty($qQ0hv->items)) { goto YnOTM; } goto pS_A9; pS_A9: foreach ($qQ0hv->items as $jEcZU => $gN60h) { goto N6AiJ; N6AiJ: if (!($gN60h->type == "\x44\111\123\x43\x4f\125\x4e\124")) { goto cDYp4; } goto lsOs_; rzYx2: $gN60h->delete(); goto kinG2; l02L9: xmiB2: goto gIgM2; kinG2: cDYp4: goto l02L9; lsOs_: $mHxWO[] = clone $gN60h; goto iP6pb; iP6pb: unset($qQ0hv->items[$jEcZU]); goto rzYx2; gIgM2: } goto wXJuo; M0ZKD: $qQ0hv->discounttaxes = 0; goto FrdoZ; pgyzS: foreach ($wK0nf as $SA3Fw) { $SA3Fw->apply_to_bill($qQ0hv); nMaKP: } goto JgyRy; Oxlon: foreach ($mHxWO as $gN60h) { goto VeyAa; i6S9m: Vn043: goto cLKyB; RmWFp: rBuc0: goto qMg2M; bi0jK: $wK0nf[$ptVwY] = $SA3Fw; goto RmWFp; tt3bU: goto a8ezy; goto i6S9m; VeyAa: preg_match("\57\x44\x28\x5b\x5c\144\53\x5d\77\x29\137\57", $gN60h->itemcode, $BAogP); goto jP1Ax; qMg2M: a8ezy: goto viB4c; cLKyB: $SA3Fw->set_productiondata(json_decode($gN60h->productiondata)); goto HfWus; rPalA: $SA3Fw = Discount::instance($ptVwY); goto p7FOZ; jP1Ax: $ptVwY = $BAogP[1]; goto rPalA; p7FOZ: if (!is_null($SA3Fw)) { goto Vn043; } goto tt3bU; HfWus: if (in_array($ptVwY, $wK0nf)) { goto rBuc0; } goto bi0jK; viB4c: } goto uBnly; HqIAU: YnOTM: goto Nl_uw; ajnvC: global $DB; goto PUkhu; Nl_uw: $qQ0hv->discount = 0; goto hAFs5; hAFs5: $qQ0hv->untaxeddiscount = 0; goto M0ZKD; OYfpn: } public function can_delete() { return empty($this->bills); } public function has_multiple_ratios() { return false; } public static function export_to_bill_template(&$vCLFM, $qQ0hv) { goto Tktf6; tr9qj: foreach ($qQ0hv->items as $gN60h) { goto FTeky; faI4i: JatT7: goto AalKO; P0E95: if (empty($syuG8->code)) { goto n9_Sz; } goto WURCi; J1OE_: n9_Sz: goto faI4i; FTeky: if (!($gN60h->type != "\x44\x49\123\103\117\125\x4e\124")) { goto u4kH2; } goto KXYNh; tHGGy: u4kH2: goto IS3yo; KXYNh: goto BGjJe; goto tHGGy; WURCi: $krVRw[] = $syuG8->code; goto J1OE_; AalKO: BGjJe: goto wD7B0; IS3yo: $vCLFM->billhasdiscounts = true; goto j39Er; j39Er: if (empty($syuG8 = json_decode($gN60h->productiondata))) { goto JatT7; } goto P0E95; wD7B0: } goto LLNcz; igtUU: if (!($qQ0hv->untaxeddiscount != $qQ0hv->discount)) { goto zVRZR; } goto iKE5Z; WFpIe: $krVRw = []; goto FGd0A; Ll0De: $vCLFM->data1 = $qQ0hv->untaxeddiscount; goto zd1M8; Tktf6: if (!empty($qQ0hv->items)) { goto wW4tZ; } goto ZF3Ah; r3ZMm: wW4tZ: goto Ll0De; DcEPx: $vCLFM->data2 = $qQ0hv->discount; goto IomX8; tV99K: $vCLFM->discounttaxes = $qQ0hv->discounttaxes; goto WFpIe; FGd0A: $vCLFM->billhasdiscounts = false; goto tr9qj; LLNcz: wcXO1: goto MqQIq; iKE5Z: $vCLFM->hasdata2 = true; goto MfJ6r; zd1M8: $vCLFM->source1 = "\165\x6e\x74\x61\x78\145\144\x64\151\x73\x63\x6f\x75\x6e\x74"; goto DcEPx; V9az9: $vCLFM->hasdata2 = false; goto igtUU; IomX8: $vCLFM->source2 = "\x64\151\x73\x63\157\x75\156\164"; goto V9az9; MqQIq: $vCLFM->discountcodes = implode("\x2c\40", $krVRw); goto UVe7K; ZF3Ah: return; goto r3ZMm; MfJ6r: zVRZR: goto tV99K; UVe7K: } public function delete() : void { goto nyWTc; Jv6Jh: auvFz: goto aH0Ij; kxVqA: parent::delete(); goto Jv6Jh; nyWTc: if (!empty($this->bills)) { goto auvFz; } goto kxVqA; aH0Ij: } public static function count($EKQKt) { return parent::_count(self::$table, $EKQKt); } public static function get_instances($EKQKt = array(), $AK9dZ = '', $hoqtN = "\x2a", $n16ZC = 0, $WSplx = '', $J79Y6 = false) { return parent::_get_instances(self::$table, $EKQKt, $AK9dZ, $hoqtN, $n16ZC, $WSplx, $J79Y6); } public static function get_instances_menu($EKQKt = array(), $AK9dZ = "\x6e\x61\x6d\x65") { return parent::_get_instances_menu(self::$table, $EKQKt, $AK9dZ, "\156\141\x6d\x65"); } }
