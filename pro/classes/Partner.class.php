<?php
/*   __________________________________________________
    |              on 2.0.12              |
    |__________________________________________________|
*/
 namespace local_shop; use StdClass; use local_shop\Customer; defined("\115\117\x4f\x44\x4c\105\x5f\x49\116\x54\x45\x52\116\101\114") || die; require_once $CFG->dirroot . "\x2f\x6c\157\x63\x61\154\x2f\x73\150\157\x70\57\x63\154\x61\x73\x73\x65\x73\x2f\123\x68\157\160\117\x62\152\145\x63\164\x2e\143\154\x61\163\163\x2e\x70\150\x70"; require_once $CFG->dirroot . "\x2f\154\157\143\x61\x6c\57\163\x68\x6f\160\x2f\x63\x6c\141\x73\163\145\163\x2f\103\165\x73\x74\157\155\x65\x72\x2e\143\x6c\x61\163\x73\x2e\160\150\160"; class Partner extends ShopObject { protected static $table = "\154\157\x63\x61\154\137\x73\x68\157\x70\137\160\x61\162\x74\156\x65\162"; public function __construct($eKsrJ, $b92uN = false) { goto cnC1Q; IBEe5: if ($eKsrJ) { goto LpkHc; } goto XRB0E; XOsTG: return; goto TjaY8; qCdoz: $this->record->enabled = 0; goto I0_X6; L2p40: $this->user = $DB->get_record("\x75\163\x65\162", ["\151\144" => $this->record->moodleuser]); goto uESM1; uESM1: m20gv: goto DM2Bf; lWOkK: $this->record->referer = ''; goto KnvCU; usY5B: if (empty($this->record->customerid)) { goto vuN_W; } goto eh9s0; ZgNnS: parent::__construct($eKsrJ, self::$table); goto IBEe5; DM2Bf: V2UiK: goto EpEWk; XRB0E: $this->record->id = 0; goto vBHLI; vBHLI: $this->record->shopid = 0; goto IDEHk; TjaY8: X2Rzd: goto usY5B; eh9s0: $this->customer = new Customer($this->record->customerid); goto NsWZN; h300F: $this->record->customerid = ''; goto qCdoz; RBNk2: $this->record->partnerkey = ''; goto lWOkK; NsWZN: vuN_W: goto AZhos; AZhos: if (empty($this->record->moodleuser)) { goto m20gv; } goto L2p40; I0_X6: goto V2UiK; goto ZSsxc; cnC1Q: global $DB; goto ZgNnS; Mfd3D: if (!$b92uN) { goto X2Rzd; } goto XOsTG; IDEHk: $this->record->name = ''; goto RBNk2; ZSsxc: LpkHc: goto Mfd3D; KnvCU: $this->record->partnersecretkey = ''; goto h300F; EpEWk: } public function disable() { $this->record->enabled = 0; } public function enable() { $this->record->enabled = 1; } public static function validate(string $kWos7) { goto MIR2b; xXCnn: if (!is_null($ds4vR)) { goto pYYu5; } goto Ywiq_; MIR2b: $ds4vR = self::get_by_key($kWos7); goto xXCnn; rWLEN: return false; goto KOsqX; Ywiq_: return false; goto IRRQ2; KOsqX: zNs0a: goto j4zAK; dpLDP: return false; goto SWCFf; XuxfI: if (!empty($_SERVER["\110\124\x54\120\137\x52\105\x46\x45\x52\105\122"])) { goto Soyh3; } goto dpLDP; PUFtM: if (preg_match("\43" . preg_quote($ds4vR->referer) . "\x23", $_SERVER["\110\124\x54\120\137\122\x45\106\105\x52\105\122"])) { goto zNs0a; } goto rWLEN; j4zAK: return true; goto OpeSc; SWCFf: Soyh3: goto PUFtM; IRRQ2: pYYu5: goto XuxfI; OpeSc: } public static function get_by_key(string $kWos7) { goto PGgbG; S30T1: viRzn: goto z6MSa; ytxrR: return new Partner($jGkux); goto S30T1; JAGh1: if (!($jGkux = $DB->get_field("\154\x6f\x63\x61\x6c\137\x73\150\157\160\137\x70\x61\162\x74\x6e\x65\162", "\x69\x64", array("\160\141\162\x74\x6e\145\162\153\145\x79" => $kWos7)))) { goto viRzn; } goto ytxrR; z6MSa: return null; goto xz4mb; PGgbG: global $DB; goto JAGh1; xz4mb: } public static function get_by_secretkey(string $KoWE0) { goto eGbbZ; Y5Hg_: return null; goto HmWn2; DoUb0: return new Partner($jGkux); goto FyPqx; eGbbZ: global $DB; goto ID1PL; FyPqx: pXTyq: goto Y5Hg_; ID1PL: if (!($jGkux = $DB->get_field("\154\x6f\x63\141\154\137\163\150\x6f\160\x5f\160\x61\x72\164\x6e\x65\x72", "\151\144", array("\160\x61\162\x74\x6e\145\x72\x73\145\143\162\x65\x74\153\x65\171" => $KoWE0)))) { goto pXTyq; } goto DoUb0; HmWn2: } public static function checkauth(StdClass $ds4vR) { goto z6bXu; XMTsA: $aMaXF = array("\145\155\x61\151\x6c" => $ds4vR->customeremail, "\144\x65\x6c\145\164\x65\x64" => 0, "\163\x75\163\160\145\156\x64\x65\144" => 0); goto tEyyj; TWqkm: return false; goto eBITJ; fJ2NF: shop_load_customerinfo($NsJtq); goto UQxPT; ioe4x: aWJV6: goto qqQdz; ZeZf9: shop_trace($SESSION->shoppingcart->transid . "\x20\x2d\40\120\141\162\x74\156\145\162\40\144\x65\x6c\145\147\141\164\145\144\40\x61\165\164\x68\x20\146\x6f\x72\40{$ds4vR->customeremail}\40\146\x72\x6f\x6d\x20{$ds4vR->partnerkey}"); goto uKCh_; uKCh_: return true; goto o82gL; gQ2k5: xUKb2: goto TWqkm; o82gL: hNio_: goto gQ2k5; a6DPc: if ($ds4vR->validated) { goto aWJV6; } goto AkmFd; UQxPT: $SESSION->shoppingcart->usedistinctinvoiceinfo = false; goto ZeZf9; AkmFd: return false; goto ioe4x; jmAXV: if (empty($ds4vR->customeremail)) { goto xUKb2; } goto XMTsA; z6bXu: global $DB, $SESSION; goto a6DPc; el7E0: return false; goto QOIqb; Adp30: complete_user_login($NsJtq); goto fJ2NF; zNIp0: if (!$NsJtq) { goto hNio_; } goto Adp30; tEyyj: $NsJtq = $DB->get_record("\165\163\x65\162", $aMaXF); goto zNIp0; qqQdz: if (!(isloggedin() && !isguestuser())) { goto yG_S8; } goto el7E0; QOIqb: yG_S8: goto jmAXV; eBITJ: } public static function resolve_customer_action($fY40V, $Q7s50) { goto T9MDm; Aupx_: unset($SESSION->shoppingcart->autodrive); goto U5JHC; kBw0E: sEL0m: goto JlUBx; Gf0JV: if ($fY40V) { goto K_ckQ; } goto jRDXP; zt4Cd: NLAUX: goto kBw0E; dCI3r: unset($SESSION->shoppingcart->autodrive); goto uKytB; odYGV: if (!empty($SESSION->shoppingcart->autodrive)) { goto ma5Yb; } goto ytou8; T9MDm: global $SESSION; goto Gf0JV; SKaGk: K_ckQ: goto odYGV; h3n0j: $Q7s50 = "\x6e\x61\166\x69\147\x61\164\145"; goto zt4Cd; JlUBx: return array($Q7s50, $SESSION->shoppingcart); goto BFKb4; voiQJ: ma5Yb: goto h3n0j; U5JHC: oWUD7: goto tD1TT; uKytB: goto NLAUX; goto voiQJ; ytou8: $Q7s50 = "\162\145\166\141\x6c\151\x64\x61\164\145"; goto dCI3r; jRDXP: if (empty($SESSION->shoppingcart->autodrive)) { goto oWUD7; } goto Aupx_; tD1TT: goto sEL0m; goto SKaGk; BFKb4: } public static function register_in_bill(&$qQ0hv, $lWyz5 = null) { goto mHgsI; jFYHA: shop_debug_trace("\x50\141\162\164\156\x65\x72\72\x3a\162\x65\x67\x69\163\x74\145\162\x5f\x69\156\137\x62\151\x6c\x6c\x20\105\162\x72\157\162\40\x3a\40{$lWyz5->partnerkey}\40\x6e\x6f\164\x20\x66\157\165\156\x64", SHOP_TRACE_ERRORS); goto hzEOa; U6Mso: $qQ0hv->partnertag = $SESSION->shoppingcart->partner->partnertag; goto m2PCB; W3D6E: D2ek1: goto Q5fAw; ArHx2: $qQ0hv->partnerid = $ds4vR->id; goto U6Mso; sxr8Q: $qQ0hv->partnerid = $ds4vR->id; goto f2GlX; Bsit_: shop_debug_trace("\x50\x61\x72\164\156\x65\162\72\72\x72\145\147\x69\163\x74\145\x72\x5f\151\156\137\142\151\154\x6c\x20\105\x72\162\x6f\162\40\146\x72\157\x6d\x20\163\150\157\x70\160\151\156\147\143\141\162\x74\x20\72\40{$SESSION->shoppingcart->partner->partnerkey}\40\156\x6f\164\40\x66\157\x75\156\x64", SHOP_TRACE_ERRORS); goto ecQlH; xMa9l: QqGn5: goto yZVVy; fyHhs: if (empty($SESSION->shoppingcart->partner)) { goto ukMZW; } goto xP014; xP014: $ds4vR = Partner::get_by_key($SESSION->shoppingcart->partner->partnerkey); goto TsEDI; kd61R: if ($ds4vR) { goto D2ek1; } goto jFYHA; F5Vxd: $ds4vR = Partner::get_by_key($lWyz5->partnerkey); goto kd61R; gajTt: ukMZW: goto xMa9l; m2PCB: WegaI: goto gajTt; mHgsI: global $SESSION; goto vEnIz; X2fSR: rWFNq: goto Tk298; TsEDI: if ($ds4vR) { goto TWE0s; } goto Bsit_; hzEOa: goto wodHg; goto W3D6E; vEnIz: if (empty($lWyz5)) { goto SrYSw; } goto F5Vxd; Tk298: wodHg: goto iVYuj; Xh7aq: TWE0s: goto ArHx2; ecQlH: goto WegaI; goto Xh7aq; Q5fAw: if (empty($qQ0hv)) { goto rWFNq; } goto sxr8Q; iVYuj: goto QqGn5; goto Hz5uZ; f2GlX: $qQ0hv->partnertag = @$lWyz5->partnertag; goto X2fSR; Hz5uZ: SrYSw: goto fyHhs; yZVVy: } public static function get_instances($EKQKt = array(), $AK9dZ = '', $hoqtN = "\x2a", $n16ZC = 0, $WSplx = '') { return parent::_get_instances(self::$table, $EKQKt, $AK9dZ, $hoqtN, $n16ZC, $WSplx); } public static function get_instances_menu($EKQKt = array(), $AK9dZ = '', $sHJ2k = "\143\x68\157\x6f\163\x65\144\x6f\164\x73") { return parent::_get_instances_menu(self::$table, $EKQKt, $AK9dZ, "\x74\151\x74\x6c\x65", $sHJ2k); } }
